<!DOCTYPE html>
<html>
<head>
<title>Otwarte zabytki - mapa edycji</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.3.1/leaflet.css" />
<!--[if lte IE 8]>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.3.1/leaflet.ie.css" />
<![endif]-->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script>
function processData(allText) {
    var allTextLines = allText.split(/\r\n|\n/);
    var lines = [];

    for (var i=0; i<allTextLines.length; i++) {
      var TextLine = allTextLines[i].split(';');
      var circleLocation = new L.LatLng(TextLine[5], TextLine[6]),
      circleOptions = {
        color: 'red',
        fillColor: '#f03'
      }
      if(TextLine[0] === "commune" ) {
        var circle = new L.Circle(circleLocation, 500, circleOptions);
        circle.bindPopup("Gmina "+TextLine[3]+", powiat "+TextLine[2]+".<br/>Województwo "+TextLine[1]+".<br/>Poprawiono "+TextLine[4]+" zabytków");
        communeSet.addLayer(circle);
      } else if (TextLine[0] === "district" ) {
        var circle = new L.Circle(circleLocation, 2500, circleOptions);
        circle.bindPopup("Powiat "+TextLine[2]+".<br/>Województwo "+TextLine[1]+".<br/>Poprawiono "+TextLine[4]+" zabytków");
        districtSet.addLayer(circle);
      } else if (TextLine[0] === "voivodeship" ) {
        var circle = new L.Circle(circleLocation, 5000, circleOptions);
        circle.bindPopup("Województwo "+TextLine[1]+".<br/>Poprawiono "+TextLine[4]+" zabytków");
        voivodeshipSet.addLayer(circle);
      } else alert("Błąd danych");
    }
}
</script>
</head>
<body>
<script src="http://cdn.leafletjs.com/leaflet-0.3.1/leaflet.js"></script>
<div id="map" style="height: 300px">
</div>
<script>
var map = new L.Map('map');
var cloudmade = new L.TileLayer('http://{s}.tile.cloudmade.com/8ee2a50541944fb9bcedded5165f09d9/997/256/{z}/{x}/{y}.png', {
    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://cloudmade.com">CloudMade</a>',
    maxZoom: 18
});
var poland = new L.LatLng(51.919438, 19.145136); // geographical point (longitude and latitude)
map.setView(poland, 5).addLayer(cloudmade);
var communeSet = new L.LayerGroup();
var districtSet = new L.LayerGroup();
var voivodeshipSet = new L.LayerGroup();
map.addLayer(voivodeshipSet);
$(document).ready(function() {
    $.ajax({
        type: "GET",
        url: "output.csv",
        dataType: "text",
        success: function(data) {processData(data);}
     });
});
map.on('zoomend' ,function() {
    if( map.getZoom() >= 10 ){
      if(map.hasLayer(districtSet))map.removeLayer(districtSet);
      if(map.hasLayer(voivodeshipSet))map.removeLayer(voivodeshipSet);
      if(!map.hasLayer(communeSet))map.addLayer(communeSet);
    } else if( map.getZoom() >= 7 ){
      if(!map.hasLayer(districtSet))map.addLayer(districtSet);
      if(map.hasLayer(voivodeshipSet))map.removeLayer(voivodeshipSet);
      if(map.hasLayer(communeSet))map.removeLayer(communeSet);
    } else if( map.getZoom() < 7 ){
      if( map.hasLayer(districtSet) )map.removeLayer(districtSet);
      if(!map.hasLayer(voivodeshipSet))map.addLayer(voivodeshipSet);
      if(map.hasLayer(communeSet))map.removeLayerLayer(communeSet);
    }
  });
</script>
</body>
</html>